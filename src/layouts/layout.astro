---
import { ClientRouter } from 'astro:transitions'
import '../styles/global.css'
import Button from '../components/button.astro'
import BreakpointIndicator from '../components/dev/breakpoint-indicator.astro'
import Analytics from '@vercel/analytics/astro'

interface Props {
	title?: string
	description?: string
	image?: string
	type?: 'website' | 'article'
}

const {
	title = 'Async',
	description = 'Thoughts and musings on web development and technology by Asier Zapata.',
	image = '/open-graph/default.png', // Fallback image, ideally should be a generic OG image
	type = 'website',
} = Astro.props

const canonicalURL = new URL(Astro.url.pathname, Astro.site)
const socialImageURL = new URL(image, Astro.url)
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.ico" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
		<meta name="description" content={description} />
		<link rel="canonical" href={canonicalURL} />
		<link
			rel="alternate"
			type="application/rss+xml"
			title="Async by Asier Zapata"
			href="/rss.xml"
		/>

		<!-- Open Graph / Facebook -->
		<meta property="og:type" content={type} />
		<meta property="og:url" content={Astro.url} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={socialImageURL} />

		<!-- Twitter -->
		<meta property="twitter:card" content="summary_large_image" />
		<meta property="twitter:url" content={Astro.url} />
		<meta property="twitter:title" content={title} />
		<meta property="twitter:description" content={description} />
		<meta property="twitter:image" content={socialImageURL} />

		<ClientRouter />
		<Analytics />
	</head>
	<body>
		<div class="border-b border-border px-3 md:px-8 lg:px-12">
			<div
				class="border-l border-r border-border bg-primary-subtle/20 py-4 px-4 md:px-8 flex flex-col md:flex-row md:justify-between md:items-center"
			>
				<div class="flex w-full md:w-auto justify-between items-center">
					<div class="flex flex-row gap-4 items-baseline">
						<a href="/">
							<h2 class="font-serif text-3xl font-medium text-primary text-center text-balance">
								Async
							</h2>
						</a>
						<p class="text-center">
							<span class="text-primary-light text-balance text-xs">by Asier Zapata</span>
						</p>
					</div>
					<button
						id="menu-toggle"
						class="md:hidden p-2 text-primary focus:outline-none cursor-pointer"
						aria-label="Toggle menu"
					>
						<svg
							xmlns="http://www.w3.org/2000/svg"
							fill="none"
							viewBox="0 0 24 24"
							stroke-width="1.5"
							stroke="currentColor"
							class="size-6"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
						</svg>
					</button>
				</div>
				<div
					id="menu-wrapper"
					class="w-full md:w-auto grid grid-rows-[0fr] md:grid-rows-none md:flex transition-[grid-template-rows] duration-300 ease-out"
				>
					<div class="overflow-hidden md:overflow-visible min-h-0">
						<nav class="flex flex-col md:flex-row gap-4 pt-4 md:pt-0 items-center">
							<Button url="/" size="sm">
								<span class="text-primary-light font-light"> Home </span>
							</Button>
							<Button url="/about-me" size="sm">
								<span class="text-primary-light font-light"> About </span>
							</Button>
						</nav>
					</div>
				</div>
			</div>
			<script>
				document.addEventListener('astro:page-load', () => {
					const toggle = document.getElementById('menu-toggle')
					const wrapper = document.getElementById('menu-wrapper')

					toggle?.addEventListener('click', () => {
						wrapper?.classList.toggle('grid-rows-[0fr]')
						wrapper?.classList.toggle('grid-rows-[1fr]')
					})
				})
			</script>
		</div>
		<main class="mx-3 grow md:mx-8 lg:mx-12 border-border border-x">
			<slot />
		</main>
		<footer class="border-t border-border px-3 md:px-8 lg:px-12">
			<div class="border-l border-r border-border py-6 text-center">
				<p class="text-primary-light text-sm">Written with ❤️ from Barcelona</p>
			</div>
		</footer>
		<BreakpointIndicator />
	</body><style>
		body {
			display: flex;
			flex-direction: column;
			min-height: 100vh;
		}
	</style>
</html>
